CREATE TABLE `steamInventories_ItemHistories` (
  `id` BIGINT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `steamID64_id` INT(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT '->steamInventories_SteamIDs.id',
  `appid` INT(10) UNSIGNED NOT NULL,
  `contextid` INT(10) UNSIGNED NOT NULL,
  `itemid` INT(10) UNSIGNED NOT NULL COMMENT '->items.id',
  `descriptionid` INT(10) UNSIGNED NOT NULL COMMENT '->steamItems_Descriptions.id',
  `assetid` BIGINT(20) UNSIGNED NOT NULL,
  `amount` INT(10) UNSIGNED NOT NULL DEFAULT 1,
  `timeseen` INT(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'UNIX timestamp when this item was first seen (when the inventory was loaded)',
  `timegone` INT(10) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'UNIX timestamp when this item was seen to no longer be in the inventory (when the inventory was loaded)',
  `isTradable` TINYINT(255) NOT NULL DEFAULT 0 COMMENT 'We need this here because the value in the description isn''t valid',
  `isMarketable` TINYINT(255) NOT NULL DEFAULT 0 COMMENT 'Same as isTradable, but for the is_marketable tag',
  `isCommodity` TINYINT(255) NOT NULL DEFAULT 0 COMMENT 'Same as isTradable, but for the is_commodity tag',
  `isActive` TINYINT(255) GENERATED ALWAYS AS (if(`timegone` = 0,1,0)) VIRTUAL COMMENT 'Whether the item is still in the Steam inventory',
  PRIMARY KEY (id, steamID64_id),
  INDEX id(id)
)
ENGINE = INNODB,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci,
COMMENT = 'History of all items seen in loaded Steam inventories of any Steam user except our bots. Includes currently existing items and items that have been moved from the inventories.'
PARTITION BY HASH (steamID64_id)
(
  PARTITION p0 ENGINE = INNODB,
  PARTITION p1 ENGINE = INNODB,
  PARTITION p10 ENGINE = INNODB,
  PARTITION p11 ENGINE = INNODB,
  PARTITION p12 ENGINE = INNODB,
  PARTITION p13 ENGINE = INNODB,
  PARTITION p14 ENGINE = INNODB,
  PARTITION p15 ENGINE = INNODB,
  PARTITION p16 ENGINE = INNODB,
  PARTITION p17 ENGINE = INNODB,
  PARTITION p18 ENGINE = INNODB,
  PARTITION p19 ENGINE = INNODB,
  PARTITION p2 ENGINE = INNODB,
  PARTITION p20 ENGINE = INNODB,
  PARTITION p21 ENGINE = INNODB,
  PARTITION p22 ENGINE = INNODB,
  PARTITION p23 ENGINE = INNODB,
  PARTITION p24 ENGINE = INNODB,
  PARTITION p25 ENGINE = INNODB,
  PARTITION p26 ENGINE = INNODB,
  PARTITION p27 ENGINE = INNODB,
  PARTITION p28 ENGINE = INNODB,
  PARTITION p29 ENGINE = INNODB,
  PARTITION p3 ENGINE = INNODB,
  PARTITION p30 ENGINE = INNODB,
  PARTITION p31 ENGINE = INNODB,
  PARTITION p32 ENGINE = INNODB,
  PARTITION p33 ENGINE = INNODB,
  PARTITION p34 ENGINE = INNODB,
  PARTITION p35 ENGINE = INNODB,
  PARTITION p36 ENGINE = INNODB,
  PARTITION p37 ENGINE = INNODB,
  PARTITION p38 ENGINE = INNODB,
  PARTITION p39 ENGINE = INNODB,
  PARTITION p4 ENGINE = INNODB,
  PARTITION p40 ENGINE = INNODB,
  PARTITION p41 ENGINE = INNODB,
  PARTITION p42 ENGINE = INNODB,
  PARTITION p43 ENGINE = INNODB,
  PARTITION p44 ENGINE = INNODB,
  PARTITION p45 ENGINE = INNODB,
  PARTITION p46 ENGINE = INNODB,
  PARTITION p47 ENGINE = INNODB,
  PARTITION p48 ENGINE = INNODB,
  PARTITION p49 ENGINE = INNODB,
  PARTITION p5 ENGINE = INNODB,
  PARTITION p6 ENGINE = INNODB,
  PARTITION p7 ENGINE = INNODB,
  PARTITION p8 ENGINE = INNODB,
  PARTITION p9 ENGINE = INNODB
);

ALTER TABLE `steamInventories_ItemHistories` 
  ADD UNIQUE INDEX SearchAndUpdate(appid, contextid, steamID64_id, assetid, timegone);